import{a as b,r as h,j as e,C as S,l as p,o as H,p as z,T as D,q as k,s as P,t as T,v as F,w as M,u as A,x as I,A as R,B as j,S as L,Z as O,y as B,z as E}from"./index-BjO4OBGt.js";import{u as V}from"./useMutation-EJ4WbH_H.js";import{u as W,t as q,F as Y,a as G,b as Z,c as K,d as _,z as m}from"./index-DBTXEaT4.js";import{C as N,a as C,b as v,c as w}from"./card-DW_tR_lU.js";import{C as Q}from"./checkbox-CuXcGr8Z.js";import{B as f}from"./badge-DEp-JO2V.js";import{M as U}from"./map-pin-uFC9G9SU.js";import{S as $}from"./store-Dk2pWrXh.js";import{A as J}from"./arrow-left-PafVpdP1.js";import{T as X}from"./target-j9Nddwl4.js";import{T as ee}from"./trending-down-CRMTAST8.js";import{C as se}from"./clock-CrSPk647.js";import{P as ae}from"./play-ZbiTDrmJ.js";import"./utils-km2FGkQ4.js";import"./label-DoS8Orlk.js";import"./index-BZt9lQWF.js";const te={"home-depot":[{id:"hd-001",name:"Home Depot - Downtown",address:"123 Main St",distance:.8,zipCode:"10001"},{id:"hd-002",name:"Home Depot - Westside",address:"456 West Ave",distance:1.2,zipCode:"10002"},{id:"hd-003",name:"Home Depot - Mall Plaza",address:"789 Mall Dr",distance:2.1,zipCode:"10003"},{id:"hd-004",name:"Home Depot - North Hills",address:"321 North Rd",distance:3.4,zipCode:"10004"},{id:"hd-005",name:"Home Depot - South Gate",address:"654 South Blvd",distance:4.2,zipCode:"10005"},{id:"hd-006",name:"Home Depot - East Valley",address:"987 East St",distance:5.1,zipCode:"10006"},{id:"hd-007",name:"Home Depot - Riverside",address:"147 River Rd",distance:6.3,zipCode:"10007"},{id:"hd-008",name:"Home Depot - Airport",address:"258 Airport Way",distance:7.8,zipCode:"10008"},{id:"hd-009",name:"Home Depot - Suburbia",address:"369 Suburb Ave",distance:8.9,zipCode:"10009"},{id:"hd-010",name:"Home Depot - Industrial",address:"741 Industrial Pkwy",distance:9.7,zipCode:"10010"},{id:"hd-011",name:"Home Depot - Metro Center",address:"852 Metro Blvd",distance:10.8,zipCode:"10011"},{id:"hd-012",name:"Home Depot - Crossroads",address:"963 Cross St",distance:12.1,zipCode:"10012"},{id:"hd-013",name:"Home Depot - Lakeside",address:"159 Lake Dr",distance:13.5,zipCode:"10013"},{id:"hd-014",name:"Home Depot - Mountain View",address:"357 Mountain Rd",distance:14.7,zipCode:"10014"},{id:"hd-015",name:"Home Depot - Valley Ridge",address:"468 Valley St",distance:15.9,zipCode:"10015"},{id:"hd-016",name:"Home Depot - Sunset",address:"579 Sunset Ave",distance:17.2,zipCode:"10016"},{id:"hd-017",name:"Home Depot - Harbor Point",address:"680 Harbor Dr",distance:18.4,zipCode:"10017"},{id:"hd-018",name:"Home Depot - Tech Center",address:"791 Tech Blvd",distance:19.6,zipCode:"10018"},{id:"hd-019",name:"Home Depot - Green Valley",address:"802 Green Way",distance:20.8,zipCode:"10019"},{id:"hd-020",name:"Home Depot - Heritage",address:"913 Heritage Rd",distance:22.1,zipCode:"10020"},{id:"hd-021",name:"Home Depot - Meadowbrook",address:"024 Meadow Ln",distance:23.5,zipCode:"10021"},{id:"hd-022",name:"Home Depot - Oakwood",address:"135 Oak St",distance:24.7,zipCode:"10022"},{id:"hd-023",name:"Home Depot - Hillcrest",address:"246 Hill Ave",distance:25.9,zipCode:"10023"},{id:"hd-024",name:"Home Depot - Parkway",address:"357 Park Dr",distance:27.2,zipCode:"10024"},{id:"hd-025",name:"Home Depot - Fairfield",address:"468 Fair Rd",distance:28.4,zipCode:"10025"}]};function re({storeId:d,storeName:n}){const{user:s}=b(),a=h.useMemo(()=>{if(!(s!=null&&s.subscriptionPlan))return 1;switch(s.subscriptionPlan){case"basic":return 5;case"premium":return 25;default:return 1}},[s==null?void 0:s.subscriptionPlan]),t=h.useMemo(()=>(te[d]||[]).slice(0,a).sort((l,c)=>l.distance-c.distance),[d,a]),o=(s==null?void 0:s.subscriptionPlan)==="basic"?"Pro Hunter":(s==null?void 0:s.subscriptionPlan)==="premium"?"Business Elite":"Free Explorer";return e.jsxs(N,{className:"mb-6",children:[e.jsx(C,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Store Coverage"]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-3 h-3"}),o," Plan"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Scanning ",a," closest ",d.replace("-"," ")," store",a>1?"s":""]})]}),(s==null?void 0:s.zipCode)&&e.jsxs(f,{variant:"secondary",children:["ZIP: ",s.zipCode]})]}),e.jsx("div",{className:"grid gap-2 max-h-60 overflow-y-auto",children:t.map((r,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-primary text-primary-foreground rounded-full text-xs font-medium",children:l+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.address})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:[r.distance," mi"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.zipCode})]})]},r.id))}),t.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx($,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No stores found in your area"})]})]})]})}function de({steps:d,currentStep:n,completedSteps:s}){const a=d.findIndex(t=>t.id===n);return e.jsx("div",{className:"w-full py-6",children:e.jsx("div",{className:"flex items-center justify-between",children:d.map((t,o)=>{const r=s.includes(t.id),l=t.id===n,c=o<a;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:p("w-10 h-10 rounded-full flex items-center justify-center border-2 transition-colors",r?"bg-green-500 border-green-500 text-white":l?"bg-blue-600 border-blue-600 text-white":c?"bg-gray-200 border-gray-300 text-gray-500":"bg-white border-gray-300 text-gray-400"),children:r?e.jsx(H,{className:"w-5 h-5"}):e.jsx(z,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mt-2",children:[e.jsx("p",{className:p("text-sm font-medium",l?"text-blue-600":"text-gray-500"),children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground max-w-20",children:t.description})]})]}),o<d.length-1&&e.jsx("div",{className:p("flex-1 h-0.5 mx-4 transition-colors",c||r?"bg-green-300":"bg-gray-200")})]},t.id)})})})}function g({content:d,children:n}){return e.jsx(D,{children:e.jsxs(k,{children:[e.jsx(P,{asChild:!0,children:n||e.jsx(T,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(F,{children:e.jsx("p",{className:"max-w-xs text-sm",children:d})})]})})}const ie=m.object({userId:m.string(),storeId:m.string(),clearanceOnly:m.boolean().default(!0),productSelection:m.literal("all")});function we(){const d=M(),[,n]=A(),{toast:s}=I(),{user:a}=b(),t=d==null?void 0:d.storeId,o=W({resolver:q(ie),defaultValues:{userId:(a==null?void 0:a.id)||"",storeId:t||"",clearanceOnly:!0,productSelection:"all"}}),r=V({mutationFn:i=>B("POST","/api/scans",i),onSuccess:async i=>{const x=await i.json();s({title:"Scan Started!",description:"Your clearance scan is now running. You'll see results as they come in."}),E.invalidateQueries({queryKey:["/api/scans"]}),n(`/scan-results/${x.id}`)},onError:i=>{console.error("Failed to create scan:",i),s({title:"Scan Failed",description:"Failed to start your clearance scan. Please try again.",variant:"destructive"})}}),l=i=>{if(!(a!=null&&a.id)){s({title:"Authentication Required",description:"Please log in to start a scan.",variant:"destructive"});return}const x={...i,userId:a.id};r.mutate(x)},c=()=>{n("/")},u=t==="home-depot"?"Home Depot":"Store",y=[{id:"select",title:"Select Stores",description:"Choose locations"},{id:"configure",title:"Configure",description:"Setup scan options"},{id:"scan",title:"Scan",description:"Find deals"},{id:"results",title:"Results",description:"View & organize"}];return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(R,{}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(de,{steps:y,currentStep:"configure",completedSteps:["select"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs(j,{variant:"ghost",onClick:c,className:"mb-4","data-testid":"button-back",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Back to Store Selection"]}),e.jsx(re,{storeId:t,storeName:u}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Configure Your Scan"})]}),e.jsxs("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:["Set up your preferences before we scan all selected ",u," locations for deals. You can filter and sort results after the scan completes."]})]})]}),e.jsx(Y,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(l),className:"space-y-6",children:[e.jsxs(N,{className:"border-2 border-blue-200 dark:border-blue-800",children:[e.jsx(C,{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20",children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600"}),"Scan Configuration"]})}),e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(O,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Full Store Scan"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Scanning all available products across all departments for the best deals."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:"Tools & Hardware"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Garden Center"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{children:"Appliances"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),e.jsx("span",{children:"Paint & Lumber"})]})]})]}),e.jsx(G,{control:o.control,name:"clearanceOnly",render:({field:i})=>e.jsxs(Z,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(K,{children:e.jsx(Q,{checked:i.value,onCheckedChange:i.onChange,"data-testid":"checkbox-clearance-only"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-red-600"}),"Clearance Items Only",e.jsx(g,{content:"When enabled, we'll only show items that are currently marked down with clearance pricing. This helps you find the best deals faster."})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Focus on items with marked-down clearance prices (recommended for best deals)"})]})]})}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"What happens next?"}),e.jsx(g,{content:"The scanning process typically takes 2-5 minutes depending on store size and network speed."})]}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[e.jsx("li",{children:"• We'll scan all selected store locations simultaneously"}),e.jsx("li",{children:"• Results will appear in real-time as we find them"}),e.jsx("li",{children:"• You can filter by category, price, and discount after scanning"}),e.jsx("li",{children:"• Add items to your shopping list for easy store navigation"})]})]})]})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(j,{type:"submit",size:"lg",disabled:r.isPending,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-12 py-3 text-lg font-semibold shadow-lg","data-testid":"button-start-scan",children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Starting Scan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-5 h-5 mr-2"}),"Start Scanning Now"]})})})]})})]})]})}export{we as default};
